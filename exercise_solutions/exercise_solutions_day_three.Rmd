---
title: "R Notebook"
output: html_notebook
---

# Set up and load relevant packages

```{r setup}
if (!require("pacman")) install.packages("pacman"); 
library(pacman)
pacman::p_load(tidyverse, dplyr, nycflights13)

#pacman installs a package before loading it if it is not already installed
```

What function would you use to read a file where fields were separated with “|”?
```{r}
# Use the read_delim() function with the argument delim="|".
```

What’s the difference between read_csv() and read_csv2()?
```{r}
#  The function read_csv() uses a comma, while read_csv2() uses a semi-colon (;)
```

Use the sample tables from the video (see the workbook linked one GitHub). Compute the rate for table2, and table4a + table4b. You will need to perform four operations:

```{r}
head(table2)

head(table4a)

head(table4b)
```

TABLE 2
```{r}
t2_cases <- table2 %>% 
  filter(type == "cases") %>%
  rename(cases = count) %>%
  arrange(country, year)

t2_population <- table2 %>% 
  filter(type == "population") %>%
  rename(population = count) %>%
  arrange(country, year)

t2_rate <- t2_population %>% 
  left_join(t2_cases, by=c("country", "year")) %>% 
  select(country, year, population, cases) %>% 
  mutate(rate = cases/population *10000)
```

TABLE 4A + 4B
```{r}
#4A is cases
#4B is population

table4_cases <- table4a %>% 
  pivot_longer(c(`1999`, `2000`), names_to = "year", values_to = "cases")

table4_population <- table4b %>% 
  pivot_longer(c(`1999`, `2000`), names_to = "year", values_to = "population")

table4_combined <- table4_cases %>% 
  left_join(table4_population, by = c("country", "year")) %>% 
  mutate(rate=cases/population *10000)

table4_combined

#‘table2’ is much more easier to work with, and involves less intermediate steps.
```

Tidy the simple tibble generated by the following code. Do you need to make it wider or longer? What are the variables?
```{r}
preg <- tribble( ~pregnant, ~male, ~female, "yes", NA, 10, "no", 20, 12)

preg #look at the dataset

preg %>% 
  pivot_longer(c(male, female), names_to = "gender", values_to = "count") %>% 
  filter(!is.na(count)) #this step is optional
```
Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination. What variables would you need? What tables would you need to combine?

Drawing the routes requires the latitude and longitude of the origin and the destination airports of each flight. This requires the flights and airports tables. The flights table has the origin (origin) and destination (dest) airport of each flight. The airports table has the longitude (lon) and latitude (lat) of each airport. To get the latitude and longitude for the origin and destination of each flight, requires two joins for flights to airports, once for the latitude and longitude of the origin airport, and once for the latitude and longitude of the destination airport. We can do this with two inner_joins (see next question).

Add the location of the origin and destination (i.e. the lat and lon) to flights.
```{r}

flights_latlon <- flights %>%
  inner_join(select(airports, origin = faa, origin_lat = lat, origin_lon = lon), by = "origin") %>%
  inner_join(select(airports, dest = faa, dest_lat = lat, dest_lon = lon), by = "dest") %>% 
  select(origin, dest, origin_lat, origin_lon, dest_lat, dest_lon)

flights_latlon
```

What weather conditions make it more likely to see a delay? (Hint, you’ll need the flights and weather tables)
```{r}
flight_weather <-
  flights %>%
  inner_join(weather, by = c(
    "origin" = "origin",
    "year" = "year",
    "month" = "month",
    "day" = "day",
    "hour" = "hour"
  )) %>% 
  select(origin, dest, arr_delay, dep_delay, temp, precip, humid, dewp, wind_dir, wind_speed, wind_gust, pressure, visib)

flight_weather
```

